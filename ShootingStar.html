<head>
    <title>Star Citizen Light Script</title>
    <meta description="A light script of a shooting star, inspired by Star Citizen" />
    <meta publisher="Hunter White" />
    <meta property="colorspeed" label="Color Cycle Speed" type="number" min="1" max="10" default="6">
    <meta property="starspeed" label="Star Speed" type="number" min="1" max="100" default="50">
  </head>
  
  <body style="margin: 0; padding: 0;">
    <canvas id="rgbCanvas" width="320" height="200"></canvas>
  </body>
  
  <script>
    // Load canvas
    var c = document.getElementById('rgbCanvas');
    var ctx = c.getContext('2d');
    const width = 320;
    const height = 200;
  // ctx.clearRect(0, 0, width, height); // clear canvas
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, width, height);
  
    const FPS = 60;
    const dustArray = [];  
    let hue = 0;
  
    var cx = width/2; // change to random later?
    var cy = height/2;
    var fill = '#bcc9d6'; //change toe Signal RGB slider later
    var angle = (2 * Math.PI) / 4;
    var outerRadius = 20;
    var innerRadius = 5;
    var rotate = 0;


  
    var xv = Math.floor(Math.random() * 76 + 25) / FPS;
    var yv = Math.floor(Math.random() * 76 + 25) / FPS;
  
    if (Math.floor(Math.random() * 2) == 0) {
      xv = -xv;
    }
    if (Math.floor(Math.random() * 2) == 0) {
      yv = -yv;
    }
  
    const drawLine = (radius, angle, action) => {
      // use cosine to get horizontal coordinate
      let x = cx + radius * Math.cos(angle);
      // use sin to get vertical coordinate
      let y = cy + radius * Math.sin(angle);
      ctx[action](x, y);
    }
  
    function drawStar () {
        ctx.beginPath();
        drawLine(outerRadius, rotate, 'moveTo');
        for (let i = 0; i <= 4; i++) {
          let outerAngle = i * angle + 0;
          let innerAngle = outerAngle + angle / 2;
          drawLine(outerRadius, outerAngle, 'lineTo');
          drawLine(innerRadius, innerAngle, 'lineTo');
        }
        ctx.fillStyle = fill;
        ctx.fill();
      }
      function newDust(){
        for(let i = 0; i < 0.5; i++) {
          dustArray.push(new Dust());
        }
      }
  
    function moveStar () {
      cx += xv;
      cy += yv;
  
      if (cx - outerRadius < 0 && xv < 0) {
        xv = -xv;
      }
      if (cx + outerRadius > width && xv > 0) {
        xv = -xv;
      }
      if (cy - outerRadius < 0 && yv < 0) {
        yv = -yv;
      }
      if (cy + outerRadius > height && yv > 0) {
        yv = -yv;
      }
      ctx.clearRect(0, 0, width, height); 
      drawStar();
      // newDust();
    };
  
    class Dust{
      constructor(){
        this.x = cx;
        this.y = cy;
        this.size = Math.random() * 6 + 1;
        this.speedX = Math.random() * 3 - 1.5;
        this.speedY = Math.random() * 3 - 1.5;
        this.color = 'hsl(' + hue + ', 100%, 50%)';
      }
      moveDust(){
        this.x += this.speedX;
        this.y += this.speedY;
        if (this.size > 0.2) this.size -= 0.1;
      }
      createDust(){
        if (cx - outerRadius < 0 && xv < 0) {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.size,0,Math.PI *2);
            ctx.fill();
        }
        if (cx + outerRadius > width && xv > 0) {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.size,0,Math.PI *2);
            ctx.fill();
        }
        if (cy - outerRadius < 0 && yv < 0) {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.size,0,Math.PI *2);
            ctx.fill();
        }
        if (cy + outerRadius > height && yv > 0) {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.size,0,Math.PI *2);
            ctx.fill();
        }
      }
    }
  
    function handleDust(){
      for(let i = 0; i < dustArray.length; i++){
        dustArray[i].moveDust();
        dustArray[i].createDust();
        for(let j = i; j < dustArray.length; j++){
            const dx = dustArray[i].x - dustArray[j].x;
            const dy = dustArray[i].y - dustArray[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            if (distance < 50){
                ctx.beginPath();
                ctx.strokeStyle = dustArray[i].color;
                ctx.lineWidth = 0.2;
                ctx.moveTo(dustArray[i].x,dustArray[i].y);
                ctx.lineTo(dustArray[j].x,dustArray[j].y);
                ctx.stroke();
                ctx.closePath();
            }
        }
        if(dustArray[i].size <= 0.3){
          dustArray.splice(i,1);
          i--;
        }
      }
    }
  
    // setInterval(newDust,1000/FPS);
    setInterval(moveStar, 1000 / FPS);
  
    function animate () {
    //   ctx.fillStyle = 'rgba(0,0,0,0.02)';
    //   ctx.fillRect(0,0,width,height);
      newDust();
      handleDust();
      hue+=2;
      window.requestAnimationFrame(animate);
    }
  
    // this has to be the last line of your code
    window.requestAnimationFrame(animate);
  </script>
  